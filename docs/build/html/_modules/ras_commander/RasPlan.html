<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ras_commander.RasPlan &mdash; RAS Commander 0.42 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=13150a28"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            RAS Commander
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ras_commander.html">ras_commander package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RAS Commander</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ras_commander.RasPlan</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ras_commander.RasPlan</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RasPlan - Operations for handling plan files in HEC-RAS projects</span>

<span class="sd">This module is part of the ras-commander library and uses a centralized logging configuration.</span>

<span class="sd">Logging Configuration:</span>
<span class="sd">- The logging is set up in the logging_config.py file.</span>
<span class="sd">- A @log_call decorator is available to automatically log function calls.</span>
<span class="sd">- Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL</span>
<span class="sd">- Logs are written to both console and a rotating file handler.</span>
<span class="sd">- The default log file is &#39;ras_commander.log&#39; in the &#39;logs&#39; directory.</span>
<span class="sd">- The default log level is INFO.</span>

<span class="sd">To use logging in this module:</span>
<span class="sd">1. Use the @log_call decorator for automatic function call logging.</span>
<span class="sd">2. For additional logging, use logger.[level]() calls (e.g., logger.info(), logger.debug()).</span>
<span class="sd">3. Obtain the logger using: logger = logging.getLogger(__name__)</span>

<span class="sd">Example:</span>
<span class="sd">    @log_call</span>
<span class="sd">    def my_function():</span>
<span class="sd">        logger = logging.getLogger(__name__)</span>
<span class="sd">        logger.debug(&quot;Additional debug information&quot;)</span>
<span class="sd">        # Function logic here</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">.RasPrj</span> <span class="kn">import</span> <span class="n">RasPrj</span><span class="p">,</span> <span class="n">ras</span>
<span class="kn">from</span> <span class="nn">.RasUtils</span> <span class="kn">import</span> <span class="n">RasUtils</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">ras_commander</span> <span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">from</span> <span class="nn">ras_commander.logging_config</span> <span class="kn">import</span> <span class="n">log_call</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RasPlan</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for operations on HEC-RAS plan files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@log_call</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_geom</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">new_geom</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the geometry for the specified plan.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            plan_number (Union[str, int]): The plan number to update.</span>
<span class="sd">            new_geom (Union[str, int]): The new geometry number to set.</span>
<span class="sd">            ras_object: An optional RAS object instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The updated geometry DataFrame.</span>

<span class="sd">        Example:</span>
<span class="sd">            updated_geom_df = RasPlan.set_geom(&#39;02&#39;, &#39;03&#39;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Ensure plan_number and new_geom are strings</span>
        <span class="n">plan_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">new_geom</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_geom</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Before doing anything, make sure the plan, geom, flow, and unsteady dataframes are current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>
        
        <span class="c1"># Log the current geometry DataFrame for debugging</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Current geometry DataFrame within the function:&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_geom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">[</span><span class="s1">&#39;geom_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry </span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2"> not found in project.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry </span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2"> not found in project.&quot;</span><span class="p">)</span>

        <span class="c1"># Update the geometry for the specified plan</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plan_number</span><span class="p">,</span> <span class="s1">&#39;geom_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_geom</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry for plan </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2"> set to </span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updated plan DataFrame:&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">)</span>

        <span class="c1"># Update the project file</span>
        <span class="n">prj_file_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">prj_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">prj_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">plan_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^Plan File=p</span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">geom_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Geom File=g\d+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">plan_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">geom_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Geom File=g</span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Geom File in project file to g</span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2"> for plan </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">prj_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated project file with new geometry for plan </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write to project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># Re-initialize the ras object to reflect changes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">ras_exe_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_steady</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_steady_flow_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a steady flow file to a plan file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        plan_number (str): Plan number (e.g., &#39;02&#39;)</span>
<span class="sd">        new_steady_flow_number (str): Steady flow number to apply (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If the specified steady flow number is not found in the project file</span>
<span class="sd">        FileNotFoundError: If the specified plan file is not found</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_steady(&#39;02&#39;, &#39;01&#39;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
                        
        <span class="c1"># Update the flow dataframe in the ras instance to ensure it is current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">new_steady_flow_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span><span class="p">[</span><span class="s1">&#39;flow_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Steady flow number </span><span class="si">{</span><span class="n">new_steady_flow_number</span><span class="si">}</span><span class="s2"> not found in project file.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Resolve the full path of the plan file</span>
        <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">ras_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Flow File=f&quot;</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Flow File=f</span><span class="si">{</span><span class="n">new_steady_flow_number</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_unsteady</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_unsteady_flow_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply an unsteady flow file to a plan file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        plan_number (str): Plan number (e.g., &#39;04&#39;)</span>
<span class="sd">        new_unsteady_flow_number (str): Unsteady flow number to apply (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If the specified unsteady number is not found in the project file</span>
<span class="sd">        FileNotFoundError: If the specified plan file is not found</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_unsteady(&#39;04&#39;, &#39;01&#39;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Update the unsteady dataframe in the ras instance to ensure it is current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">new_unsteady_flow_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="s1">&#39;unsteady_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsteady number </span><span class="si">{</span><span class="n">new_unsteady_flow_number</span><span class="si">}</span><span class="s2"> not found in project file.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get the full path of the plan file</span>
        <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">ras_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">RasUtils</span><span class="o">.</span><span class="n">update_plan_file</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;Unsteady&#39;</span><span class="p">,</span> <span class="n">new_unsteady_flow_number</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update unsteady flow file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_num_cores</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">num_cores</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the maximum number of cores to use in the HEC-RAS plan file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        plan_number (str): Plan number (e.g., &#39;02&#39;) or full path to the plan file</span>
<span class="sd">        num_cores (int): Maximum number of cores to use</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Notes on setting num_cores in HEC-RAS:</span>
<span class="sd">        The recommended setting for num_cores is 2 (most efficient) to 8 (most performant)</span>
<span class="sd">        More details in the HEC-Commander Repository Blog &quot;Benchmarking is All You Need&quot;</span>
<span class="sd">        https://github.com/billk-FM/HEC-Commander/blob/main/Blog/7._Benchmarking_Is_All_You_Need.md</span>
<span class="sd">        </span>
<span class="sd">        Microsoft Windows has a maximum of 64 cores that can be allocated to a single Ras.exe process. </span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; # Using plan number</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_num_cores(&#39;02&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; # Using full path to plan file</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_num_cores(&#39;/path/to/project.p02&#39;, 4)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Determine if plan_number is a path or a plan number</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">. Please provide a valid plan number or path.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update the plan dataframe in the ras instance to ensure it is current</span>
            <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Plan&#39;</span><span class="p">)</span>
            
            <span class="c1"># Get the full path of the plan file</span>
            <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">ras_obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">. Please provide a valid plan number or path.&quot;</span><span class="p">)</span>
        
        <span class="n">cores_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(UNET D1 Cores= )\d+&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">new_content</span> <span class="o">=</span> <span class="n">cores_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">num_cores</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write to plan file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_geom_preprocessor</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">run_htab</span><span class="p">,</span> <span class="n">use_ib_tables</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the simulation plan file to modify the `Run HTab` and `UNET Use Existing IB Tables` settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        file_path (str): Path to the simulation plan file (.p06 or similar) that you want to modify.</span>
<span class="sd">        run_htab (int): Value for the `Run HTab` setting:</span>
<span class="sd">            - `0` : Do not run the geometry preprocessor, use existing geometry tables.</span>
<span class="sd">            - `-1` : Run the geometry preprocessor, forcing a recomputation of the geometry tables.</span>
<span class="sd">        use_ib_tables (int): Value for the `UNET Use Existing IB Tables` setting:</span>
<span class="sd">            - `0` : Use existing interpolation/boundary (IB) tables without recomputing them.</span>
<span class="sd">            - `-1` : Do not use existing IB tables, force a recomputation.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If `run_htab` or `use_ib_tables` are not integers or not within the accepted values (`0` or `-1`).</span>
<span class="sd">        FileNotFoundError: If the specified file does not exist.</span>
<span class="sd">        IOError: If there is an error reading or writing the file.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_geom_preprocessor(&#39;/path/to/project.p06&#39;, run_htab=-1, use_ib_tables=0)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">run_htab</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value for `Run HTab`. Expected `0` or `-1`.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_ib_tables</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value for `UNET Use Existing IB Tables`. Expected `0` or `-1`.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">updated_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Run HTab=&quot;</span><span class="p">):</span>
                    <span class="n">updated_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Run HTab= </span><span class="si">{</span><span class="n">run_htab</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">updated_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated_line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;UNET Use Existing IB Tables=&quot;</span><span class="p">):</span>
                    <span class="n">updated_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;UNET Use Existing IB Tables= </span><span class="si">{</span><span class="n">use_ib_tables</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">updated_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated_line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">updated_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">updated_lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while reading or writing the file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_results_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the results file path for a given HEC-RAS plan number.</span>

<span class="sd">        Args:</span>
<span class="sd">            plan_number (str): The HEC-RAS plan number for which to find the results path.</span>
<span class="sd">            ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: The full path to the results file if found and the file exists, or None if not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">            &gt;&gt;&gt; results_path = ras_plan.get_results_path(&#39;01&#39;)</span>
<span class="sd">            &gt;&gt;&gt; if results_path:</span>
<span class="sd">            ...     print(f&quot;Results file found at: {results_path}&quot;)</span>
<span class="sd">            ... else:</span>
<span class="sd">            ...     print(&quot;Results file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Update the plan dataframe in the ras instance to ensure it is current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        
        <span class="c1"># Ensure plan_number is a string</span>
        <span class="n">plan_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">plan_entry</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plan_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_entry</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">results_path</span> <span class="o">=</span> <span class="n">plan_entry</span><span class="p">[</span><span class="s1">&#39;HDF_Results_Path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">results_path</span> <span class="ow">and</span> <span class="n">Path</span><span class="p">(</span><span class="n">results_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">results_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given plan number.</span>
<span class="sd">        </span>
<span class="sd">        This method ensures that the latest plan entries are included by refreshing</span>
<span class="sd">        the plan dataframe before searching for the requested plan number.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">        plan_number (str): The plan number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the plan file if found, None otherwise.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; plan_path = ras_plan.get_plan_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if plan_path:</span>
<span class="sd">        ...     print(f&quot;Plan file found at: {plan_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Plan file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated plan dataframe</span>
        <span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        
        <span class="n">plan_path</span> <span class="o">=</span> <span class="n">plan_df</span><span class="p">[</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plan_number</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">plan_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_flow_path</span><span class="p">(</span><span class="n">flow_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given flow number.</span>

<span class="sd">        Args:</span>
<span class="sd">        flow_number (str): The flow number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the flow file if found, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; flow_path = ras_plan.get_flow_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if flow_path:</span>
<span class="sd">        ...     print(f&quot;Flow file found at: {flow_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Flow file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated flow dataframe</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>
        
        <span class="n">flow_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span><span class="p">[</span><span class="s1">&#39;flow_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">flow_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flow_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">flow_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_unsteady_path</span><span class="p">(</span><span class="n">unsteady_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given unsteady number.</span>

<span class="sd">        Args:</span>
<span class="sd">        unsteady_number (str): The unsteady number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the unsteady file if found, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; unsteady_path = ras_plan.get_unsteady_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if unsteady_path:</span>
<span class="sd">        ...     print(f&quot;Unsteady file found at: {unsteady_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Unsteady file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated unsteady dataframe</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Unsteady&#39;</span><span class="p">)</span>
        
        <span class="n">unsteady_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="s1">&#39;unsteady_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">unsteady_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unsteady_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">unsteady_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_geom_path</span><span class="p">(</span><span class="n">geom_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given geometry number.</span>

<span class="sd">        Args:</span>
<span class="sd">        geom_number (str): The geometry number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the geometry file if found, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; geom_path = ras_plan.get_geom_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if geom_path:</span>
<span class="sd">        ...     print(f&quot;Geometry file found at: {geom_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Geometry file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated geom dataframe</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Geom&#39;</span><span class="p">)</span>
        
        <span class="n">geom_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">[</span><span class="s1">&#39;geom_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">geom_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">geom_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">geom_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Clone Functions to copy unsteady, flow, and geometry files from templates</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">clone_plan</span><span class="p">(</span><span class="n">template_plan</span><span class="p">,</span> <span class="n">new_plan_shortid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new plan file based on a template and update the project file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        template_plan (str): Plan number to use as template (e.g., &#39;01&#39;)</span>
<span class="sd">        new_plan_shortid (str, optional): New short identifier for the plan file</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        str: New plan number</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; new_plan_number = ras_plan.clone_plan(&#39;01&#39;, new_plan_shortid=&#39;New Plan&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;New plan created with number: {new_plan_number}&quot;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Update plan entries without reinitializing the entire project</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Plan&#39;</span><span class="p">)</span>

        <span class="n">new_plan_num</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_next_number</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">])</span>
        <span class="n">template_plan_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.p</span><span class="si">{</span><span class="n">template_plan</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_plan_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.p</span><span class="si">{</span><span class="n">new_plan_num</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_plan_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template plan file &#39;</span><span class="si">{</span><span class="n">template_plan_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template_plan_path</span><span class="p">,</span> <span class="n">new_plan_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_plan_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">plan_lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New plan file not found after copying: </span><span class="si">{</span><span class="n">new_plan_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">shortid_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Short Identifier=(.*)$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plan_lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">shortid_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_shortid</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_plan_shortid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new_shortid</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_shortid</span> <span class="o">+</span> <span class="s2">&quot;_copy&quot;</span><span class="p">)[:</span><span class="mi">24</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_shortid</span> <span class="o">=</span> <span class="n">new_plan_shortid</span><span class="p">[:</span><span class="mi">24</span><span class="p">]</span>
                <span class="n">plan_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Short Identifier=</span><span class="si">{</span><span class="n">new_shortid</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_plan_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">plan_lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated short identifier to </span><span class="si">{</span><span class="n">new_plan_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the new Plan File entry line</span>
        <span class="n">new_plan_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Plan File=p</span><span class="si">{</span><span class="n">new_plan_num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Find the correct insertion point for the new Plan File entry</span>
        <span class="n">plan_file_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Plan File=p(\d+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">plan_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_number</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_plan_num</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">new_plan_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to insert after the last Plan File entry</span>
            <span class="n">plan_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">plan_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
            <span class="k">if</span> <span class="n">plan_indices</span><span class="p">:</span>
                <span class="n">last_plan_index</span> <span class="o">=</span> <span class="n">plan_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_plan_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_plan_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Append at the end if no Plan File entries exist</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_plan_line</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Write the updated lines back to the project file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">new_plan</span> <span class="o">=</span> <span class="n">new_plan_num</span>
        
        <span class="c1"># Re-initialize the ras global object</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">ras_exe_path</span><span class="p">)</span>

        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">new_plan</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">clone_unsteady</span><span class="p">(</span><span class="n">template_unsteady</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy unsteady flow files from a template, find the next unsteady number,</span>
<span class="sd">        and update the project file accordingly.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        template_unsteady (str): Unsteady flow number to be used as a template (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        str: New unsteady flow number (e.g., &#39;03&#39;)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; new_unsteady_num = ras_plan.clone_unsteady(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;New unsteady flow file created: u{new_unsteady_num}&quot;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Update unsteady entries without reinitializing the entire project</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Unsteady&#39;</span><span class="p">)</span>

        <span class="n">new_unsteady_num</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_next_number</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="s1">&#39;unsteady_number&#39;</span><span class="p">])</span>
        <span class="n">template_unsteady_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">template_unsteady</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_unsteady_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">new_unsteady_num</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_unsteady_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template unsteady file &#39;</span><span class="si">{</span><span class="n">template_unsteady_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template_unsteady_path</span><span class="p">,</span> <span class="n">new_unsteady_path</span><span class="p">)</span>

        <span class="c1"># Copy the corresponding .hdf file if it exists</span>
        <span class="n">template_hdf_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">template_unsteady</span><span class="si">}</span><span class="s2">.hdf&quot;</span>
        <span class="n">new_hdf_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">new_unsteady_num</span><span class="si">}</span><span class="s2">.hdf&quot;</span>
        <span class="k">if</span> <span class="n">template_hdf_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template_hdf_path</span><span class="p">,</span> <span class="n">new_hdf_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the new Unsteady Flow File entry line</span>
        <span class="n">new_unsteady_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unsteady File=u</span><span class="si">{</span><span class="n">new_unsteady_num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Find the correct insertion point for the new Unsteady Flow File entry</span>
        <span class="n">unsteady_file_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Unsteady File=u(\d+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">unsteady_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_number</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_unsteady_num</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">new_unsteady_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to insert after the last Unsteady Flow File entry</span>
            <span class="n">unsteady_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">unsteady_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
            <span class="k">if</span> <span class="n">unsteady_indices</span><span class="p">:</span>
                <span class="n">last_unsteady_index</span> <span class="o">=</span> <span class="n">unsteady_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_unsteady_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_unsteady_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Append at the end if no Unsteady Flow File entries exist</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_unsteady_line</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Write the updated lines back to the project file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">new_unsteady</span> <span class="o">=</span> <span class="n">new_unsteady_num</span>
        
        <span class="c1"># Re-initialize the ras global object</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">ras_exe_path</span><span class="p">)</span>
        
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">new_unsteady</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RasPlan - Operations for handling plan files in HEC-RAS projects</span>

<span class="sd">This module is part of the ras-commander library and uses a centralized logging configuration.</span>

<span class="sd">Logging Configuration:</span>
<span class="sd">- The logging is set up in the logging_config.py file.</span>
<span class="sd">- A @log_call decorator is available to automatically log function calls.</span>
<span class="sd">- Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL</span>
<span class="sd">- Logs are written to both console and a rotating file handler.</span>
<span class="sd">- The default log file is &#39;ras_commander.log&#39; in the &#39;logs&#39; directory.</span>
<span class="sd">- The default log level is INFO.</span>

<span class="sd">To use logging in this module:</span>
<span class="sd">1. Use the @log_call decorator for automatic function call logging.</span>
<span class="sd">2. For additional logging, use logger.[level]() calls (e.g., logger.info(), logger.debug()).</span>
<span class="sd">3. Obtain the logger using: logger = logging.getLogger(__name__)</span>

<span class="sd">Example:</span>
<span class="sd">    @log_call</span>
<span class="sd">    def my_function():</span>
<span class="sd">        logger = logging.getLogger(__name__)</span>
<span class="sd">        logger.debug(&quot;Additional debug information&quot;)</span>
<span class="sd">        # Function logic here</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">.RasPrj</span> <span class="kn">import</span> <span class="n">RasPrj</span><span class="p">,</span> <span class="n">ras</span>
<span class="kn">from</span> <span class="nn">.RasUtils</span> <span class="kn">import</span> <span class="n">RasUtils</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">ras_commander</span> <span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">from</span> <span class="nn">ras_commander.logging_config</span> <span class="kn">import</span> <span class="n">log_call</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="RasPlan">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan">[docs]</a>
<span class="k">class</span> <span class="nc">RasPlan</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for operations on HEC-RAS plan files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RasPlan.set_geom">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.set_geom">[docs]</a>
    <span class="nd">@log_call</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_geom</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">new_geom</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the geometry for the specified plan.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            plan_number (Union[str, int]): The plan number to update.</span>
<span class="sd">            new_geom (Union[str, int]): The new geometry number to set.</span>
<span class="sd">            ras_object: An optional RAS object instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The updated geometry DataFrame.</span>

<span class="sd">        Example:</span>
<span class="sd">            updated_geom_df = RasPlan.set_geom(&#39;02&#39;, &#39;03&#39;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Ensure plan_number and new_geom are strings</span>
        <span class="n">plan_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">new_geom</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_geom</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Before doing anything, make sure the plan, geom, flow, and unsteady dataframes are current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>
        
        <span class="c1"># Log the current geometry DataFrame for debugging</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Current geometry DataFrame within the function:&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_geom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">[</span><span class="s1">&#39;geom_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry </span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2"> not found in project.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry </span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2"> not found in project.&quot;</span><span class="p">)</span>

        <span class="c1"># Update the geometry for the specified plan</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plan_number</span><span class="p">,</span> <span class="s1">&#39;geom_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_geom</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry for plan </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2"> set to </span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updated plan DataFrame:&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">)</span>

        <span class="c1"># Update the project file</span>
        <span class="n">prj_file_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">prj_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">prj_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">plan_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^Plan File=p</span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">geom_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Geom File=g\d+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">plan_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">geom_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Geom File=g</span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Geom File in project file to g</span><span class="si">{</span><span class="n">new_geom</span><span class="si">}</span><span class="s2"> for plan </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">prj_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated project file with new geometry for plan </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write to project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># Re-initialize the ras object to reflect changes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">ras_exe_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span></div>


<div class="viewcode-block" id="RasPlan.set_steady">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.set_steady">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_steady</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_steady_flow_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a steady flow file to a plan file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        plan_number (str): Plan number (e.g., &#39;02&#39;)</span>
<span class="sd">        new_steady_flow_number (str): Steady flow number to apply (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If the specified steady flow number is not found in the project file</span>
<span class="sd">        FileNotFoundError: If the specified plan file is not found</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_steady(&#39;02&#39;, &#39;01&#39;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
                        
        <span class="c1"># Update the flow dataframe in the ras instance to ensure it is current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">new_steady_flow_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span><span class="p">[</span><span class="s1">&#39;flow_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Steady flow number </span><span class="si">{</span><span class="n">new_steady_flow_number</span><span class="si">}</span><span class="s2"> not found in project file.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Resolve the full path of the plan file</span>
        <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">ras_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Flow File=f&quot;</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Flow File=f</span><span class="si">{</span><span class="n">new_steady_flow_number</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span></div>


<div class="viewcode-block" id="RasPlan.set_unsteady">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.set_unsteady">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_unsteady</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_unsteady_flow_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply an unsteady flow file to a plan file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        plan_number (str): Plan number (e.g., &#39;04&#39;)</span>
<span class="sd">        new_unsteady_flow_number (str): Unsteady flow number to apply (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If the specified unsteady number is not found in the project file</span>
<span class="sd">        FileNotFoundError: If the specified plan file is not found</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_unsteady(&#39;04&#39;, &#39;01&#39;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Update the unsteady dataframe in the ras instance to ensure it is current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">new_unsteady_flow_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="s1">&#39;unsteady_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsteady number </span><span class="si">{</span><span class="n">new_unsteady_flow_number</span><span class="si">}</span><span class="s2"> not found in project file.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get the full path of the plan file</span>
        <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">ras_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">RasUtils</span><span class="o">.</span><span class="n">update_plan_file</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;Unsteady&#39;</span><span class="p">,</span> <span class="n">new_unsteady_flow_number</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update unsteady flow file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span></div>


<div class="viewcode-block" id="RasPlan.set_num_cores">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.set_num_cores">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_num_cores</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">num_cores</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the maximum number of cores to use in the HEC-RAS plan file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        plan_number (str): Plan number (e.g., &#39;02&#39;) or full path to the plan file</span>
<span class="sd">        num_cores (int): Maximum number of cores to use</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Notes on setting num_cores in HEC-RAS:</span>
<span class="sd">        The recommended setting for num_cores is 2 (most efficient) to 8 (most performant)</span>
<span class="sd">        More details in the HEC-Commander Repository Blog &quot;Benchmarking is All You Need&quot;</span>
<span class="sd">        https://github.com/billk-FM/HEC-Commander/blob/main/Blog/7._Benchmarking_Is_All_You_Need.md</span>
<span class="sd">        </span>
<span class="sd">        Microsoft Windows has a maximum of 64 cores that can be allocated to a single Ras.exe process. </span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; # Using plan number</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_num_cores(&#39;02&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; # Using full path to plan file</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_num_cores(&#39;/path/to/project.p02&#39;, 4)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Determine if plan_number is a path or a plan number</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">. Please provide a valid plan number or path.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update the plan dataframe in the ras instance to ensure it is current</span>
            <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Plan&#39;</span><span class="p">)</span>
            
            <span class="c1"># Get the full path of the plan file</span>
            <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">,</span> <span class="n">ras_obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_number</span><span class="si">}</span><span class="s2">. Please provide a valid plan number or path.&quot;</span><span class="p">)</span>
        
        <span class="n">cores_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(UNET D1 Cores= )\d+&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">new_content</span> <span class="o">=</span> <span class="n">cores_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">num_cores</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write to plan file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span></div>


<div class="viewcode-block" id="RasPlan.set_geom_preprocessor">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.set_geom_preprocessor">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">set_geom_preprocessor</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">run_htab</span><span class="p">,</span> <span class="n">use_ib_tables</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the simulation plan file to modify the `Run HTab` and `UNET Use Existing IB Tables` settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        file_path (str): Path to the simulation plan file (.p06 or similar) that you want to modify.</span>
<span class="sd">        run_htab (int): Value for the `Run HTab` setting:</span>
<span class="sd">            - `0` : Do not run the geometry preprocessor, use existing geometry tables.</span>
<span class="sd">            - `-1` : Run the geometry preprocessor, forcing a recomputation of the geometry tables.</span>
<span class="sd">        use_ib_tables (int): Value for the `UNET Use Existing IB Tables` setting:</span>
<span class="sd">            - `0` : Use existing interpolation/boundary (IB) tables without recomputing them.</span>
<span class="sd">            - `-1` : Do not use existing IB tables, force a recomputation.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If `run_htab` or `use_ib_tables` are not integers or not within the accepted values (`0` or `-1`).</span>
<span class="sd">        FileNotFoundError: If the specified file does not exist.</span>
<span class="sd">        IOError: If there is an error reading or writing the file.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.set_geom_preprocessor(&#39;/path/to/project.p06&#39;, run_htab=-1, use_ib_tables=0)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">run_htab</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value for `Run HTab`. Expected `0` or `-1`.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_ib_tables</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value for `UNET Use Existing IB Tables`. Expected `0` or `-1`.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">updated_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Run HTab=&quot;</span><span class="p">):</span>
                    <span class="n">updated_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Run HTab= </span><span class="si">{</span><span class="n">run_htab</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">updated_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated_line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;UNET Use Existing IB Tables=&quot;</span><span class="p">):</span>
                    <span class="n">updated_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;UNET Use Existing IB Tables= </span><span class="si">{</span><span class="n">use_ib_tables</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">updated_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated_line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">updated_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">updated_lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while reading or writing the file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Update the ras object&#39;s dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span></div>


<div class="viewcode-block" id="RasPlan.get_results_path">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.get_results_path">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_results_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the results file path for a given HEC-RAS plan number.</span>

<span class="sd">        Args:</span>
<span class="sd">            plan_number (str): The HEC-RAS plan number for which to find the results path.</span>
<span class="sd">            ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: The full path to the results file if found and the file exists, or None if not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">            &gt;&gt;&gt; results_path = ras_plan.get_results_path(&#39;01&#39;)</span>
<span class="sd">            &gt;&gt;&gt; if results_path:</span>
<span class="sd">            ...     print(f&quot;Results file found at: {results_path}&quot;)</span>
<span class="sd">            ... else:</span>
<span class="sd">            ...     print(&quot;Results file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Update the plan dataframe in the ras instance to ensure it is current</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        
        <span class="c1"># Ensure plan_number is a string</span>
        <span class="n">plan_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plan_number</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">plan_entry</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plan_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_entry</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">results_path</span> <span class="o">=</span> <span class="n">plan_entry</span><span class="p">[</span><span class="s1">&#39;HDF_Results_Path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">results_path</span> <span class="ow">and</span> <span class="n">Path</span><span class="p">(</span><span class="n">results_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">results_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="RasPlan.get_plan_path">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.get_plan_path">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_plan_path</span><span class="p">(</span><span class="n">plan_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given plan number.</span>
<span class="sd">        </span>
<span class="sd">        This method ensures that the latest plan entries are included by refreshing</span>
<span class="sd">        the plan dataframe before searching for the requested plan number.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">        plan_number (str): The plan number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the plan file if found, None otherwise.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; plan_path = ras_plan.get_plan_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if plan_path:</span>
<span class="sd">        ...     print(f&quot;Plan file found at: {plan_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Plan file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated plan dataframe</span>
        <span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        
        <span class="n">plan_path</span> <span class="o">=</span> <span class="n">plan_df</span><span class="p">[</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plan_number</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">plan_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="RasPlan.get_flow_path">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.get_flow_path">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_flow_path</span><span class="p">(</span><span class="n">flow_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given flow number.</span>

<span class="sd">        Args:</span>
<span class="sd">        flow_number (str): The flow number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the flow file if found, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; flow_path = ras_plan.get_flow_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if flow_path:</span>
<span class="sd">        ...     print(f&quot;Flow file found at: {flow_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Flow file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated flow dataframe</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>
        
        <span class="n">flow_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span><span class="p">[</span><span class="s1">&#39;flow_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">flow_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flow_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">flow_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="RasPlan.get_unsteady_path">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.get_unsteady_path">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_unsteady_path</span><span class="p">(</span><span class="n">unsteady_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given unsteady number.</span>

<span class="sd">        Args:</span>
<span class="sd">        unsteady_number (str): The unsteady number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the unsteady file if found, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; unsteady_path = ras_plan.get_unsteady_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if unsteady_path:</span>
<span class="sd">        ...     print(f&quot;Unsteady file found at: {unsteady_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Unsteady file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated unsteady dataframe</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Unsteady&#39;</span><span class="p">)</span>
        
        <span class="n">unsteady_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="s1">&#39;unsteady_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">unsteady_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unsteady_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">unsteady_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="RasPlan.get_geom_path">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.get_geom_path">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_geom_path</span><span class="p">(</span><span class="n">geom_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full path for a given geometry number.</span>

<span class="sd">        Args:</span>
<span class="sd">        geom_number (str): The geometry number to search for.</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        Optional[str]: The full path of the geometry file if found, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">        RuntimeError: If the project is not initialized.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; geom_path = ras_plan.get_geom_path(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; if geom_path:</span>
<span class="sd">        ...     print(f&quot;Geometry file found at: {geom_path}&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Geometry file not found.&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>
        
        <span class="c1"># Use updated geom dataframe</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Geom&#39;</span><span class="p">)</span>
        
        <span class="n">geom_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">[</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">[</span><span class="s1">&#39;geom_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">geom_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">geom_path</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">geom_path</span><span class="p">[</span><span class="s1">&#39;full_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="c1"># Clone Functions to copy unsteady, flow, and geometry files from templates</span>

<div class="viewcode-block" id="RasPlan.clone_plan">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.clone_plan">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">clone_plan</span><span class="p">(</span><span class="n">template_plan</span><span class="p">,</span> <span class="n">new_plan_shortid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new plan file based on a template and update the project file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        template_plan (str): Plan number to use as template (e.g., &#39;01&#39;)</span>
<span class="sd">        new_plan_shortid (str, optional): New short identifier for the plan file</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        str: New plan number</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; new_plan_number = ras_plan.clone_plan(&#39;01&#39;, new_plan_shortid=&#39;New Plan&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;New plan created with number: {new_plan_number}&quot;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Update plan entries without reinitializing the entire project</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Plan&#39;</span><span class="p">)</span>

        <span class="n">new_plan_num</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_next_number</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span><span class="p">[</span><span class="s1">&#39;plan_number&#39;</span><span class="p">])</span>
        <span class="n">template_plan_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.p</span><span class="si">{</span><span class="n">template_plan</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_plan_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.p</span><span class="si">{</span><span class="n">new_plan_num</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_plan_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template plan file &#39;</span><span class="si">{</span><span class="n">template_plan_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template_plan_path</span><span class="p">,</span> <span class="n">new_plan_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_plan_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">plan_lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New plan file not found after copying: </span><span class="si">{</span><span class="n">new_plan_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">shortid_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Short Identifier=(.*)$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plan_lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">shortid_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_shortid</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_plan_shortid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new_shortid</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_shortid</span> <span class="o">+</span> <span class="s2">&quot;_copy&quot;</span><span class="p">)[:</span><span class="mi">24</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_shortid</span> <span class="o">=</span> <span class="n">new_plan_shortid</span><span class="p">[:</span><span class="mi">24</span><span class="p">]</span>
                <span class="n">plan_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Short Identifier=</span><span class="si">{</span><span class="n">new_shortid</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_plan_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">plan_lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated short identifier to </span><span class="si">{</span><span class="n">new_plan_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the new Plan File entry line</span>
        <span class="n">new_plan_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Plan File=p</span><span class="si">{</span><span class="n">new_plan_num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Find the correct insertion point for the new Plan File entry</span>
        <span class="n">plan_file_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Plan File=p(\d+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">plan_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_number</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_plan_num</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">new_plan_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to insert after the last Plan File entry</span>
            <span class="n">plan_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">plan_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
            <span class="k">if</span> <span class="n">plan_indices</span><span class="p">:</span>
                <span class="n">last_plan_index</span> <span class="o">=</span> <span class="n">plan_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_plan_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_plan_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Append at the end if no Plan File entries exist</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_plan_line</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Write the updated lines back to the project file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">new_plan</span> <span class="o">=</span> <span class="n">new_plan_num</span>
        
        <span class="c1"># Re-initialize the ras global object</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">ras_exe_path</span><span class="p">)</span>

        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">new_plan</span></div>


<div class="viewcode-block" id="RasPlan.clone_unsteady">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.clone_unsteady">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">clone_unsteady</span><span class="p">(</span><span class="n">template_unsteady</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy unsteady flow files from a template, find the next unsteady number,</span>
<span class="sd">        and update the project file accordingly.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        template_unsteady (str): Unsteady flow number to be used as a template (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        str: New unsteady flow number (e.g., &#39;03&#39;)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; new_unsteady_num = ras_plan.clone_unsteady(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;New unsteady flow file created: u{new_unsteady_num}&quot;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Update unsteady entries without reinitializing the entire project</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Unsteady&#39;</span><span class="p">)</span>

        <span class="n">new_unsteady_num</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_next_number</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span><span class="p">[</span><span class="s1">&#39;unsteady_number&#39;</span><span class="p">])</span>
        <span class="n">template_unsteady_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">template_unsteady</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_unsteady_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">new_unsteady_num</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_unsteady_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template unsteady file &#39;</span><span class="si">{</span><span class="n">template_unsteady_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template_unsteady_path</span><span class="p">,</span> <span class="n">new_unsteady_path</span><span class="p">)</span>

        <span class="c1"># Copy the corresponding .hdf file if it exists</span>
        <span class="n">template_hdf_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">template_unsteady</span><span class="si">}</span><span class="s2">.hdf&quot;</span>
        <span class="n">new_hdf_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.u</span><span class="si">{</span><span class="n">new_unsteady_num</span><span class="si">}</span><span class="s2">.hdf&quot;</span>
        <span class="k">if</span> <span class="n">template_hdf_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template_hdf_path</span><span class="p">,</span> <span class="n">new_hdf_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the new Unsteady Flow File entry line</span>
        <span class="n">new_unsteady_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unsteady File=u</span><span class="si">{</span><span class="n">new_unsteady_num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Find the correct insertion point for the new Unsteady Flow File entry</span>
        <span class="n">unsteady_file_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Unsteady File=u(\d+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">unsteady_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_number</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_unsteady_num</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">new_unsteady_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to insert after the last Unsteady Flow File entry</span>
            <span class="n">unsteady_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">unsteady_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
            <span class="k">if</span> <span class="n">unsteady_indices</span><span class="p">:</span>
                <span class="n">last_unsteady_index</span> <span class="o">=</span> <span class="n">unsteady_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_unsteady_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_unsteady_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Append at the end if no Unsteady Flow File entries exist</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_unsteady_line</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Write the updated lines back to the project file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">new_unsteady</span> <span class="o">=</span> <span class="n">new_unsteady_num</span>
        
        <span class="c1"># Re-initialize the ras global object</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">ras_exe_path</span><span class="p">)</span>
        
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">new_unsteady</span></div>


<div class="viewcode-block" id="RasPlan.clone_steady">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.clone_steady">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">clone_steady</span><span class="p">(</span><span class="n">template_flow</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy steady flow files from a template, find the next flow number,</span>
<span class="sd">        and update the project file accordingly.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        template_flow (str): Flow number to be used as a template (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        str: New flow number (e.g., &#39;03&#39;)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; ras_plan = RasPlan()</span>
<span class="sd">        &gt;&gt;&gt; new_flow_num = ras_plan.clone_steady(&#39;01&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;New steady flow file created: f{new_flow_num}&quot;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Update flow entries without reinitializing the entire project</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>

        <span class="n">new_flow_num</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_next_number</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span><span class="p">[</span><span class="s1">&#39;flow_number&#39;</span><span class="p">])</span>
        <span class="n">template_flow_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.f</span><span class="si">{</span><span class="n">template_flow</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_flow_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.f</span><span class="si">{</span><span class="n">new_flow_num</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_flow_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template steady flow file &#39;</span><span class="si">{</span><span class="n">template_flow_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">template_flow_path</span><span class="p">,</span> <span class="n">new_flow_path</span><span class="p">)</span>

        <span class="c1"># Read the contents of the project file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the new Steady Flow File entry line</span>
        <span class="n">new_flow_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Flow File=f</span><span class="si">{</span><span class="n">new_flow_num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Find the correct insertion point for the new Steady Flow File entry</span>
        <span class="n">flow_file_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Flow File=f(\d+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">flow_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_number</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_flow_num</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">new_flow_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to insert after the last Steady Flow File entry</span>
            <span class="n">flow_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">flow_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
            <span class="k">if</span> <span class="n">flow_indices</span><span class="p">:</span>
                <span class="n">last_flow_index</span> <span class="o">=</span> <span class="n">flow_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_flow_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_flow_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Append at the end if no Steady Flow File entries exist</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_flow_line</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Write the updated lines back to the project file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">new_steady</span> <span class="o">=</span> <span class="n">new_flow_num</span>
        
        <span class="c1"># Re-initialize the ras global object</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">ras_exe_path</span><span class="p">)</span>
        
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">new_steady</span></div>


<div class="viewcode-block" id="RasPlan.clone_geom">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.clone_geom">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">clone_geom</span><span class="p">(</span><span class="n">template_geom</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy geometry files from a template, find the next geometry number,</span>
<span class="sd">        and update the project file accordingly.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        template_geom (str): Geometry number to be used as a template (e.g., &#39;01&#39;)</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        str: New geometry number (e.g., &#39;03&#39;)</span>

<span class="sd">        Note:</span>
<span class="sd">            This function updates the ras object&#39;s dataframes after modifying the project structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="c1"># Update geometry entries without reinitializing the entire project</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_prj_entries</span><span class="p">(</span><span class="s1">&#39;Geom&#39;</span><span class="p">)</span>

        <span class="n">template_geom_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.g</span><span class="si">{</span><span class="n">template_geom</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">template_geom_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="n">template_geom_filename</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">template_geom_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template geometry file &#39;</span><span class="si">{</span><span class="n">template_geom_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="n">next_geom_number</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_next_number</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span><span class="p">[</span><span class="s1">&#39;geom_number&#39;</span><span class="p">])</span>

        <span class="n">new_geom_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.g</span><span class="si">{</span><span class="n">next_geom_number</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_geom_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="n">new_geom_filename</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">template_geom_path</span><span class="p">,</span> <span class="n">new_geom_path</span><span class="p">)</span>

        <span class="c1"># Handle HDF file copy</span>
        <span class="n">template_hdf_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.g</span><span class="si">{</span><span class="n">template_geom</span><span class="si">}</span><span class="s2">.hdf&quot;</span>
        <span class="n">new_hdf_path</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.g</span><span class="si">{</span><span class="n">next_geom_number</span><span class="si">}</span><span class="s2">.hdf&quot;</span>
        <span class="k">if</span> <span class="n">template_hdf_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">template_hdf_path</span><span class="p">,</span> <span class="n">new_hdf_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project file not found: </span><span class="si">{</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the new Geometry File entry line</span>
        <span class="n">new_geom_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Geom File=g</span><span class="si">{</span><span class="n">next_geom_number</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Find the correct insertion point for the new Geometry File entry</span>
        <span class="n">geom_file_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Geom File=g(\d+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">geom_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">current_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_number</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">next_geom_number</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">new_geom_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to insert after the last Geometry File entry</span>
            <span class="n">geom_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">geom_file_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
            <span class="k">if</span> <span class="n">geom_indices</span><span class="p">:</span>
                <span class="n">last_geom_index</span> <span class="o">=</span> <span class="n">geom_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_geom_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_geom_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Append at the end if no Geometry File entries exist</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_geom_line</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Write the updated lines back to the project file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ras_obj</span><span class="o">.</span><span class="n">prj_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write updated project file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">new_geom</span> <span class="o">=</span> <span class="n">next_geom_number</span>
        
        <span class="c1"># Update all dataframes in the ras object</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">new_geom</span></div>


<div class="viewcode-block" id="RasPlan.get_next_number">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.get_next_number">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_next_number</span><span class="p">(</span><span class="n">existing_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the next available number from a list of existing numbers.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        existing_numbers (list): List of existing numbers as strings</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        str: Next available number as a zero-padded string</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; existing_numbers = [&#39;01&#39;, &#39;02&#39;, &#39;04&#39;]</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.get_next_number(existing_numbers)</span>
<span class="sd">        &#39;03&#39;</span>
<span class="sd">        &gt;&gt;&gt; existing_numbers = [&#39;01&#39;, &#39;02&#39;, &#39;03&#39;]</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.get_next_number(existing_numbers)</span>
<span class="sd">        &#39;04&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">existing_numbers</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">existing_numbers</span><span class="p">)</span>
        <span class="n">next_number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">existing_numbers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="n">next_number</span><span class="p">:</span>
                <span class="n">next_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">next_number</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="RasPlan.get_plan_value">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.get_plan_value">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">get_plan_value</span><span class="p">(</span>
        <span class="n">plan_number_or_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a specific value from a HEC-RAS plan file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        plan_number_or_path (Union[str, Path]): The plan number (1 to 99) or full path to the plan file</span>
<span class="sd">        key (str): The key to retrieve from the plan file</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        Any: The value associated with the specified key</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If the plan file is not found</span>
<span class="sd">        IOError: If there&#39;s an error reading the plan file</span>

<span class="sd">        Available keys and their expected types:</span>
<span class="sd">        - &#39;Computation Interval&#39; (str): Time value for computational time step (e.g., &#39;5SEC&#39;, &#39;2MIN&#39;)</span>
<span class="sd">        - &#39;DSS File&#39; (str): Name of the DSS file used</span>
<span class="sd">        - &#39;Flow File&#39; (str): Name of the flow input file</span>
<span class="sd">        - &#39;Friction Slope Method&#39; (int): Method selection for friction slope (e.g., 1, 2)</span>
<span class="sd">        - &#39;Geom File&#39; (str): Name of the geometry input file</span>
<span class="sd">        - &#39;Mapping Interval&#39; (str): Time interval for mapping output</span>
<span class="sd">        - &#39;Plan File&#39; (str): Name of the plan file</span>
<span class="sd">        - &#39;Plan Title&#39; (str): Title of the simulation plan</span>
<span class="sd">        - &#39;Program Version&#39; (str): Version number of HEC-RAS</span>
<span class="sd">        - &#39;Run HTAB&#39; (int): Flag to run HTab module (-1 or 1)</span>
<span class="sd">        - &#39;Run Post Process&#39; (int): Flag to run post-processing (-1 or 1)</span>
<span class="sd">        - &#39;Run Sediment&#39; (int): Flag to run sediment transport module (0 or 1)</span>
<span class="sd">        - &#39;Run UNET&#39; (int): Flag to run unsteady network module (-1 or 1)</span>
<span class="sd">        - &#39;Run WQNET&#39; (int): Flag to run water quality module (0 or 1)</span>
<span class="sd">        - &#39;Short Identifier&#39; (str): Short name or ID for the plan</span>
<span class="sd">        - &#39;Simulation Date&#39; (str): Start and end dates/times for simulation</span>
<span class="sd">        - &#39;UNET D1 Cores&#39; (int): Number of cores used in 1D calculations</span>
<span class="sd">        - &#39;UNET Use Existing IB Tables&#39; (int): Flag for using existing internal boundary tables (-1, 0, or 1)</span>
<span class="sd">        - &#39;UNET 1D Methodology&#39; (str): 1D calculation methodology</span>
<span class="sd">        - &#39;UNET D2 Solver Type&#39; (str): 2D solver type</span>
<span class="sd">        - &#39;UNET D2 Name&#39; (str): Name of the 2D area</span>
<span class="sd">        - &#39;Run RASMapper&#39; (int): Flag to run RASMapper for floodplain mapping (-1 for off, 0 for on)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Note: </span>
<span class="sd">        Writing Multi line keys like &#39;Description&#39; are not supported by this function.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; computation_interval = RasPlan.get_plan_value(&quot;01&quot;, &quot;Computation Interval&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Computation interval: {computation_interval}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="n">supported_plan_keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Computation Interval&#39;</span><span class="p">,</span> <span class="s1">&#39;DSS File&#39;</span><span class="p">,</span> <span class="s1">&#39;Flow File&#39;</span><span class="p">,</span> <span class="s1">&#39;Friction Slope Method&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Geom File&#39;</span><span class="p">,</span> <span class="s1">&#39;Mapping Interval&#39;</span><span class="p">,</span> <span class="s1">&#39;Plan File&#39;</span><span class="p">,</span> <span class="s1">&#39;Plan Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Program Version&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Run HTAB&#39;</span><span class="p">,</span> <span class="s1">&#39;Run Post Process&#39;</span><span class="p">,</span> <span class="s1">&#39;Run Sediment&#39;</span><span class="p">,</span> <span class="s1">&#39;Run UNET&#39;</span><span class="p">,</span> <span class="s1">&#39;Run WQNET&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Short Identifier&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulation Date&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET D1 Cores&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET Use Existing IB Tables&#39;</span><span class="p">,</span>
            <span class="s1">&#39;UNET 1D Methodology&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET D2 Solver Type&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET D2 Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Run RASMapper&#39;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_plan_keys</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">. Valid keys are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported_plan_keys</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Add more keys and explanations in get_plan_value() as needed.&quot;</span><span class="p">)</span>

        <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_number_or_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number_or_path</span><span class="p">,</span> <span class="n">ras_object</span><span class="o">=</span><span class="n">ras_obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plan_file_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading plan file </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Description&#39;</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Begin DESCRIPTION(.*?)END DESCRIPTION&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=(.*)&quot;</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not found in the plan file.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="RasPlan.update_plan_value">
<a class="viewcode-back" href="../../ras_commander.RasPlan.html#ras_commander.RasPlan.update_plan_value">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@log_call</span>
    <span class="k">def</span> <span class="nf">update_plan_value</span><span class="p">(</span>
        <span class="n">plan_number_or_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">ras_object</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a specific key-value pair in a HEC-RAS plan file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        plan_number_or_path (Union[str, Path]): The plan number (1 to 99) or full path to the plan file</span>
<span class="sd">        key (str): The key to update in the plan file</span>
<span class="sd">        value (Any): The new value to set for the key</span>
<span class="sd">        ras_object (RasPrj, optional): Specific RAS object to use. If None, uses the global ras instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">        ValueError: If the plan file is not found</span>
<span class="sd">        IOError: If there&#39;s an error reading or writing the plan file</span>

<span class="sd">        Note: See the docstring of get_plan_value for a full list of available keys and their types.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.update_plan_value(&quot;01&quot;, &quot;computation_interval&quot;, &quot;10SEC&quot;)</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.update_plan_value(&quot;/path/to/plan.p01&quot;, &quot;run_htab&quot;, 1)</span>
<span class="sd">        &gt;&gt;&gt; RasPlan.update_plan_value(&quot;01&quot;, &quot;run_rasmapper&quot;, 0)  # Turn on Floodplain Mapping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ras_obj</span> <span class="o">=</span> <span class="n">ras_object</span> <span class="ow">or</span> <span class="n">ras</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">check_initialized</span><span class="p">()</span>

        <span class="n">supported_plan_keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Computation Interval&#39;</span><span class="p">,</span> <span class="s1">&#39;DSS File&#39;</span><span class="p">,</span> <span class="s1">&#39;Flow File&#39;</span><span class="p">,</span> <span class="s1">&#39;Friction Slope Method&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Geom File&#39;</span><span class="p">,</span> <span class="s1">&#39;Mapping Interval&#39;</span><span class="p">,</span> <span class="s1">&#39;Plan File&#39;</span><span class="p">,</span> <span class="s1">&#39;Plan Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Program Version&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Run HTAB&#39;</span><span class="p">,</span> <span class="s1">&#39;Run Post Process&#39;</span><span class="p">,</span> <span class="s1">&#39;Run Sediment&#39;</span><span class="p">,</span> <span class="s1">&#39;Run UNET&#39;</span><span class="p">,</span> <span class="s1">&#39;Run WQNET&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Short Identifier&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulation Date&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET D1 Cores&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET Use Existing IB Tables&#39;</span><span class="p">,</span>
            <span class="s1">&#39;UNET 1D Methodology&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET D2 Solver Type&#39;</span><span class="p">,</span> <span class="s1">&#39;UNET D2 Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Run RASMapper&#39;</span>
        <span class="p">}</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_plan_keys</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">. Valid keys are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported_plan_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_number_or_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan_file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">plan_file_path</span> <span class="o">=</span> <span class="n">RasPlan</span><span class="o">.</span><span class="n">get_plan_path</span><span class="p">(</span><span class="n">plan_number_or_path</span><span class="p">,</span> <span class="n">ras_object</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plan_file_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan file not found: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading plan file </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># Special handling for description</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;description&#39;</span><span class="p">:</span>
            <span class="n">description_start</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">description_end</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Begin DESCRIPTION&#39;</span><span class="p">:</span>
                    <span class="n">description_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;END DESCRIPTION&#39;</span><span class="p">:</span>
                    <span class="n">description_end</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">description_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">description_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">description_start</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">description_end</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Begin DESCRIPTION</span><span class="se">\n</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">END DESCRIPTION</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For other keys</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">=&quot;</span>
            <span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
                    <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">updated</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not found in the plan file.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plan_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> in plan file: </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error writing to plan file </span><span class="si">{</span><span class="n">plan_file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># Refresh RasPrj dataframes</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">plan_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_plan_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_geom_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">flow_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_flow_entries</span><span class="p">()</span>
        <span class="n">ras_obj</span><span class="o">.</span><span class="n">unsteady_df</span> <span class="o">=</span> <span class="n">ras_obj</span><span class="o">.</span><span class="n">get_unsteady_entries</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, William Katzenmeyer, P.E., C.F.M..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>